<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Day 3 | Network Models and HIV/STI with EpiModel | Harvard 2017" />


<title>Tutorial 5: An SEIR Epidemic</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NME HSPH</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://epimodel.org/">
    <span class="fa fa-database"></span>
     
    EpiModel
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Tutorial 5: An SEIR Epidemic</h1>
<h4 class="author"><em>Day 3 | Network Models and HIV/STI with EpiModel | Harvard 2017</em></h4>

</div>


<p>EpiModel includes an integrated SIR model, but here we show how to model an SEIR disease like Ebola. The <strong>E</strong> compartment in this disease is an exposed state in which a person has been infected but is not infectious to others. Some infectious diseases have this latent non-infectious stage, and in general it provides a general framework for transmission risk that is dependent on one’s stage of disease progression.</p>
<pre class="r"><code>library(&quot;EpiModel&quot;)</code></pre>
<p>This model uses a basic SEIR design, with no births or deaths for the sake of simplicity. Similar to the previous example, we will have one replacement module and one new supplemental module. Adding in an extra disease stage involves updating the transmission module and adding a more generalized disease progression module that is based on the existing recovery module.</p>
<div id="developing-modules" class="section level1">
<h1>Developing Modules</h1>
<div id="infection-module" class="section level2">
<h2>Infection Module</h2>
<p>The built-in infection module is designed to handle a wide variety of specifications to the integrated network models. It also is designed to transition persons from a susceptible disease state to an infected disease state. Our replacement module can eliminate many of the complexities of the existing one, and must be updated to transition newly infected persons to the latent exposed but non-infectious state.</p>
<p>In contrast to the first extension example, here we do not print the full module in one code block for the sake of clarity, but it is contained in the R script file accompanying this article. The core structure of the module is exactly the same as the modules defined in the prior example.</p>
<pre class="r"><code>infect &lt;- function(dat, at) {
  # Operations
  return(dat)
}</code></pre>
<p>The main processes within the module are to extract a “discordant edgelist”, which is a matrix of ID numbers of active dyads in the network in which one member of the dyad is disease-susceptible and the other is infected. Given epidemic parameters for the probability of infection per act and the number of acts per unit time, the per-partnership transmission rate is calculated as an exponential function of the two. Transmission is modeled as a stochastic process for each discordant pair, with a Bernoulli probability distribution controlling whether an infection event occurs.</p>
<pre class="r"><code>del &lt;- discord_edgelist(dat, idsInf, idsSus, at)
del$transProb &lt;- dat$param$inf.prob
del$actRate &lt;- dat$param$act.rate
del$finalProb &lt;- 1-((1-del$transProb)^del$actRate)
transmit &lt;- rbinom(nrow(del), 1, del$finalProb)
del &lt;- del[which(transmit == 1), ]</code></pre>
<p>The key component that required updating in this module was to specify the newly infected person’s infection status as <code>&quot;e&quot;</code>, whereas the default value transitions persons to <code>&quot;i&quot;</code>.</p>
<pre class="r"><code>dat$attr$status[idsNewInf] &lt;- &quot;e&quot;
dat$attr$infTime[idsNewInf] &lt;- at</code></pre>
<p>The final lines within the module also tracks the size of this transition between susceptible and exposed states in a summary vector, <code>se.flow</code>, that will be available for analysis.</p>
</div>
<div id="disease-progression-module" class="section level2">
<h2>Disease Progression Module</h2>
<p>The disease progression module will simulate the transition from exposed to infectious, and also the transition from infectious to recovered in the model. The full structure of this module function, <code>progress</code>, is contained in the script file. The first part of the new module will pull two parameters from the input lists that define these two rates of transition.</p>
<p>The two disease progression processes are not infectious events, compared to the transmission process where the disease incidence depends on the prevalence of disease in the full population. Instead both progression events are individual-level stochastic processes, in which there is a constant hazard of transition. The times spent in each disease compartment therefore follow a geometric distribution. The code block here is for the transition between exposed to infectious states. For each eligible person for transition, the event is modeled as a stochastic process following a Bernoulli distribution with the rate parameter, <code>ei.rate</code>. Persons who do transition to the infectious state have their individual-level <code>status</code> attribute updated to the <code>&quot;i&quot;</code> value, at which point they are now capable of infecting others.</p>
<pre class="r"><code>nInf &lt;- 0
idsEligInf &lt;- which(active == 1 &amp; status == &quot;e&quot;)
nEligInf &lt;- length(idsEligInf)
if (nEligInf &gt; 0) {
  vecInf &lt;- which(rbinom(nEligInf, 1, ei.rate) == 1)
  if (length(vecInf) &gt; 0) {
    idsInf &lt;- idsEligInf[vecInf]
    nInf &lt;- length(idsInf)
    status[idsInf] &lt;- &quot;i&quot;
  }
}</code></pre>
<p>The final job of this module is to calculate summary statistics and store them for analysis. In the module, we will calculate both incident events and the size of the group in each disease state. The size of the susceptible and infected states is automatically calculated in all models.</p>
<pre class="r"><code>dat$epi$ei.flow[at] &lt;- nInf
dat$epi$ir.flow[at] &lt;- nRec
dat$epi$e.num[at] &lt;- sum(active == 1 &amp; status == &quot;e&quot;)
dat$epi$r.num[at] &lt;- sum(active == 1 &amp; status == &quot;r&quot;)</code></pre>
</div>
</div>
<div id="model-parameterization" class="section level1">
<h1>Model Parameterization</h1>
<p>There will be four parameters for the epidemic model, two of which are used in the infection module and the other two for the disease progression module. One must take care to ensure that the names of the variables is consistent between the inputs here and the module definition. In this example, the average time spent in the exposed and infectious states are the same, but these parameters could be easily changed.</p>
<pre class="r"><code>param &lt;- param.net(inf.prob = 0.5, act.rate = 2, ei.rate = 0.01, ir.rate = 0.01)
init &lt;- init.net(i.num = 10, status.rand = FALSE)</code></pre>
<p>For the control settings, we specify that the model should be simulated over 1000 time steps 10 times. The infection module function is passed to the existing <code>infection.FUN</code> argument, while the new progression module function is passed to a new <code>progress.FUN</code> argument. Since the disease progression function is handling the disease recovery process, the recovery module is toggled off by setting its function value to <code>NULL</code>. The <code>skip.check</code> setting toggles off some internal error checking intended for integrated models.</p>
<pre class="r"><code>control &lt;- control.net(type = &quot;SI&quot;, nsteps = 1000, nsims = 10, 
                       infection.FUN = infect, progress.FUN = progress, 
                       recovery.FUN = NULL, skip.check = TRUE, 
                       depend = FALSE, verbose.int = 0)</code></pre>
<p>Similar to the previous example, we are using a simple random-mixing network model in order to focus on the new epidemiological inputs and structures.</p>
<pre class="r"><code>nw &lt;- network.initialize(500, directed = FALSE)
est &lt;- netest(nw, formation = ~edges, target.stats = 150,
              coef.diss = dissolution_coefs(~offset(edges), 10))</code></pre>
</div>
<div id="simulation" class="section level1">
<h1>Simulation</h1>
<p>Methods for simulating and analyzing the model here are consistent with all the examples above. This is an example of an independent model because there are no vital dynamics within the system, so the it should take a relatively short time to simulate the full epidemic over 1000 time steps.</p>
<pre class="r"><code>sim &lt;- netsim(est, param, init, control)</code></pre>
<p>Finally, we plot the outcomes of the four compartment sizes over time. Adding an exposed, non-infectious stage in the model has the effect of reducing the speed of the epidemic growth, but in this closed population nearly everyone gets infected within the simulation time frame of the model.</p>
<pre class="r"><code>par(mar = c(3,3,1,1), mgp = c(2,1,0))
plot(sim, y = c(&quot;s.num&quot;, &quot;i.num&quot;, &quot;e.num&quot;, &quot;r.num&quot;), 
     mean.col = 1:4, qnts = 1, qnts.col = 1:4, legend = TRUE)</code></pre>
<p><img src="d3-tut5_files/figure-html/ExtEx2-plot1-1.png" width="672" /></p>
<br>
<hr style="background-color:#909090;height:1px;width:100%">
<p><small> <em>Last updated:</em> 2017-06-28 with EpiModel v1.5.0 </small></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
