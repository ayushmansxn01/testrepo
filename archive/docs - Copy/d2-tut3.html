<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Day 2 | Network Models and HIV/STI with EpiModel | Harvard 2017" />


<title>Tutorial 3: Time-Varying Biology &amp; Behavior</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NME HSPH</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://epimodel.org/">
    <span class="fa fa-database"></span>
     
    EpiModel
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Tutorial 3: Time-Varying Biology &amp; Behavior</h1>
<h4 class="author"><em>Day 2 | Network Models and HIV/STI with EpiModel | Harvard 2017</em></h4>

</div>


<p>Network models in EpiModel allow for time-varying transmission probabilities and act rates. For both parameters, <em>time is relative to the time of infection</em>. This allows for modeling of heterogeneity in transmission risk as a function of, for example, the disease stage of the infected partner in a discordant relationship.</p>
<div id="generic-model" class="section level1">
<h1>Generic Model</h1>
<p>To vary transmission probability over disease stage, pass <em>a vector</em> into the <code>inf.prob</code> parameter within <code>param.net</code>. The vector should contain a transmission probability for each time step of a person’s infection. EpiModel will repeat the final number in the vector for the total length of a person’s infection, even if it lasts longer than that duration implied by the length of the vector (consider the implications of that!).</p>
<p>To model a two-stage infection where the second stage persists at a lower rate for the length of a person’s infection, however long that is, use this. With the time unit in weeks, in this case, probability will be 50% for the first 10 weeks of a person’s infection and 5% thereafter for the total duration of his infection.</p>
<pre class="r"><code>probs &lt;- c(0.5, 0.05)
durs &lt;- c(10, 1)
inf.probs &lt;- rep(probs, durs)</code></pre>
<p>Act rates may also vary by infection duration. Consider the situation above where there is a high transmission probability during an acute stage of infection, but there would be more variability in the number of acts during this acute stage. For example, the mean number of acts across infection time is 3, but during the acute stage it is a random draw with the mean of 3:</p>
<pre class="r"><code>act.rates &lt;- c(rpois(10, lambda = 3), 3)</code></pre>
<p>This is the time-series of both the infection probabilities and act rates. Again, the final value for each will persist for the duration of the person’s infection until to recovery or exit from the network.</p>
<pre class="r"><code>par(mfrow = c(1, 2))
plot(inf.probs, type = &quot;S&quot;, lwd = 2, ylim = 0:1)
plot(act.rates, type = &quot;S&quot;, lwd = 2)
abline(h = 3, lty = 2)</code></pre>
<p><img src="d2-tut3_files/figure-html/plotRates-1.png" width="672" /></p>
<p>Here we estimate a basic ERGM and simulate an SIS disease over that network to examine the output. Note that the vectors of <code>inf.probs</code> and <code>act.rates</code> is entered into <code>param.net</code> instead of single values.</p>
<pre class="r"><code>nw &lt;- network.initialize(n = 100, directed = FALSE)
formation &lt;- ~edges
target.stats &lt;- 50
coef.diss &lt;- dissolution_coefs(dissolution = ~offset(edges), duration = 20)
est &lt;- netest(nw, formation, target.stats, coef.diss, verbose = FALSE)
param &lt;- param.net(inf.prob = inf.probs, act.rate = act.rates, rec.rate = 0.01)
init &lt;- init.net(i.num = 10)
control &lt;- control.net(type = &quot;SIS&quot;, nsteps = 100, nsims = 1)
sim &lt;- netsim(est, param, init, control)</code></pre>
<p>Now the transmission matrix shows variation in the <code>transProb</code> and <code>actRate</code> by <code>infDur</code>, or the duration of infection.</p>
<pre class="r"><code>tm &lt;- get_transmat(sim)
head(tm, 10)</code></pre>
<pre><code>   at          sus          inf infDur transProb actRate finalProb
1   2 239535076319 2395487c1158     44      0.05       3  0.142625
2   2 23951462f31a 23953d2379f3      1      0.50       2  0.750000
3   2 239537927556  2395f2d0dbe     24      0.05       3  0.142625
4   2 239570557d9a 23953d2379f3      1      0.50       2  0.750000
5   3 23956b43a763 239570557d9a      1      0.50       2  0.750000
6   3 239523e8f9b9  2395f2d0dbe     25      0.05       3  0.142625
7   3 239513885cd5 239535076319      1      0.50       2  0.750000
8   3 2395487c1158 239535076319      1      0.50       2  0.750000
9   4 239526a28b99 2395487c1158      1      0.50       2  0.750000
10  4 2395776cc3fb 23956b43a763      1      0.50       2  0.750000</code></pre>
<pre class="r"><code>mean(tm$infDur &lt;= 10)</code></pre>
<pre><code>[1] 0.5849057</code></pre>
</div>
<div id="hiv-model" class="section level1">
<h1>HIV Model</h1>
<p><a href="http://www.ncbi.nlm.nih.gov/pubmed/18662132">Hollingsworth (2008)</a> estimated the <em>rates</em> of HIV-1 transmission by month of infection, wherein there are four stages of disease: acute, chronic, preAIDS, and AIDS. The monthly transmission <em>rates</em> in each of these stages is 0.2055, 0.0088, 0.0614, and 0, respectively. The duration of each of these stages in months is estimated as 3, 100, 9, and 10 months, respectively. Therefore, the transmission probability vector would be specified as:</p>
<pre class="r"><code>probs &lt;- c(0.2055, 0.0088, 0.0614, 0)
durs &lt;- c(3, 100, 9, 10)
inf.probs &lt;- rep(probs, durs)
inf.probs</code></pre>
<pre><code>  [1] 0.2055 0.2055 0.2055 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [11] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [21] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [31] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [41] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [51] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [61] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [71] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [81] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
 [91] 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088 0.0088
[101] 0.0088 0.0088 0.0088 0.0614 0.0614 0.0614 0.0614 0.0614 0.0614 0.0614
[111] 0.0614 0.0614 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000 0.0000
[121] 0.0000 0.0000</code></pre>
<p>That corresponds to the <em>rate</em> of infection in a monthly time step in which the infected partner is at each of those 122 months in his or her infection.</p>
<p>In Hollingsworth, acts were not explicitly modeled, but there were effectively zero acts in the final stage. So an alternative parameterization that models acts (with a hypothetical increased transmission probability during AIDS) would be:</p>
<pre class="r"><code>probs &lt;- c(0.2055, 0.0088, 0.0614, 0.1)
acts &lt;- c(1, 1, 1, 0)
durs &lt;- c(3, 100, 9, 10)
inf.probs &lt;- rep(probs, durs)
act.rates &lt;- rep(acts, durs)</code></pre>
<p>Here’s a plot of the time series of the probabilities and rates over the course of HIV infection.</p>
<pre class="r"><code>par(mfrow = c(1,1))
plot(inf.probs, type = &quot;S&quot;, ylim = c(0, 1), lwd = 2)
lines(act.rates, type = &quot;S&quot;, col = 2, lwd = 2)
legend(1, 0.8, legend = c(&quot;inf.probs&quot;, &quot;act.rates&quot;), 
       lwd = 3, col = 1:2, bty = &quot;n&quot;)</code></pre>
<p><img src="d2-tut3_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<br>
<hr style="background-color:#909090;height:1px;width:100%">
<p><small> <em>Last updated:</em> 2017-06-24 with EpiModel v1.5.0 </small></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
